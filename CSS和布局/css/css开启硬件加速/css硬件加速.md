# css 动画之硬件加速

## 为什么要关心硬件加速？

有时候在实际项目开发过程中，有时候会出现动画卡顿的现象，为了使我们的动画更加流畅，我们就需要采用硬件加速，其就是通过启用GPU来进行渲染，解放cpu，来使网页中的动画更加流畅。

### 现象：

实际开发过过程中，我们通过改变`left`和`top`的值，在执行动画的过程中，`cpu`一直在进行运算，再此过程中一直发生着重绘，我们如果通过`transfrom`来实现动画，此时`cpu`基本不需要进行运算，并且`fps`相对比较高，对此我们可以得知通过硬件加速可以提高渲染能力，同时也解放了`cpu`.

### 原理

DOM树和css结合后形成渲染树。渲染书中包含了的大量的渲染元素，每一个渲染元素都会被分到一个图层中，每个图层又会被加载到`GPU`形成渲染纹理。在执行`transfrom`是不会触发重绘的，，这一点类似于我们的3D绘图功能，最终这些使用transfrom的图层都会由独立合成器进行处理。

### 复合图层

我们通过`ransfrom`来创建一个图层，此时GPU会来执行`transfrom`操作，这个图层就是复合图层。目前我们满足以下条件就会创建复合图层。

- `3D`或`css transfrom`
- `<video>`和`<canvas>`标签
- 元素覆盖时使用`z-index`属性
- 拥有加速 CSS 过滤器的元素，如CSS filters
- 对自己的 opacity 做 CSS 动画或使用一个动画 webkit 变换的元素

### 启用硬件加速

- transfrom
- opacity
- filter
- will-change //兼容性

对于transfrom 2D 来说，只有在运行时才会创建图层，但对于transfrom 3D，在渲染前就创建了图层。
因此我们通过transfrom3D属性强制开启GPU加速

```css
transfrom:translateZ(0);
transfrom:rotateZ(360deg);
```

### 注意事项

- 我们不能给每一个元素都启用硬件加速，这样回占用很大的内存，这样页面反而会有卡顿。
- GPU加速会影响字体的抗齿距效果，这是因为GPU和CPU具有不同的渲染机制，即使最终硬件加速停止了，文本还是会在动画期间显示得很模糊。