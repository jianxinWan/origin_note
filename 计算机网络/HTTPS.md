# HTTPS

## HTTP的不足

- 通信使用明文，内容可能会被窃听
- 不验证通信方的身份，因此可能遭遇伪装
- 无法证明报文的完成性，有可能被篡改

## HTTP + 加密 + 认证 + 完成性保护 = HTTPS

![https](https://user-gold-cdn.xitu.io/2018/5/21/1638197d976620af?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

https并非是应用层的一种新协议。只是HTTP通信接口部分用SSL和TLS协议代替而已，通常HTTP直接通过TCP进行通信，当使用SSL时，则演变成先和SSL通信，再有SSL和TCP进行通信，所谓HTTPS就是身披SSL的HTTP。

### 对称加密

加密和解密采用同一个密钥的加密方式。

`问题`

对应多个客户端时必须采用不同的加密算法
对称加密密钥传输

### 非对称加密

非对称加密RSA,非对称加密会有一对密钥：公钥和私钥。公钥加密的内容，只有私钥可以解开，私钥加密的内容，所有的公钥就可以解开。

![非对称加密](https://user-gold-cdn.xitu.io/2018/5/21/1638197d2f09eab3?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

问题：

存在中间人进行假造，中间人拿到客户端请求公钥的请求，服务器端返回真公钥之后，中间人用自己的假公钥换掉服务器端传回来的公钥，将假公钥返回给客户端，客户端在通过假公钥进行加密，中间人用自己饿假私钥进行解密，拿到输出内容，将内容进行更改，再将之前劫持的公钥加密，传回给服务器端然后服务器端用真私钥进行加密，然后中间人将自己的假私钥进行加密，传会给客户端。

![中间人劫持](https://user-gold-cdn.xitu.io/2018/5/21/1638197d56d46dc7?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

### 第三方认证

公钥被掉包，是因无发判断是中间人还是服务器

在HTTPS中，使用证书+数字签名来解决这个问题

![第三方认证](https://user-gold-cdn.xitu.io/2018/5/21/1638197d961729a3?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

假如中间人拦截后把服务器的公钥替换为自己的公钥，因为数字签名的存在，会导致客户端验证签名不匹配，这样就防止了中间人替换公钥的问题

### 数字证书认证机构的业务流程

首先，服务器的运营人员向数字证书认证机构提出公开公钥的申请。数字证书认证机构在判明提出申请者的身份之后，会对已申请的公开密钥做数字签名，然后分配这个已签名的公开密钥，并将该公开密钥
放入公钥证书后绑定到一起。

服务端会将份数字证书认证的机构颁发的公钥发送给客户端，以进行公开密钥的加密方式通信

接收到证书的客户端使用数字证书认证机构的公开公钥，对那张证书上的数字签名进行验证，一旦验证通过，客户端便可明确两件事：确定认证机构，确定公钥是真是可靠的。

`认证机关的公开密钥必须安全的转交给客户端，如何转交是一件困难的事，因此，多数浏览器开发商发布版本时，会事先在内部植入常用认证机关的公开密钥`
 