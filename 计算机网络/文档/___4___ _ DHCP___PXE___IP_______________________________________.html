<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link rel="stylesheet" href="demo.css">
</head>
<body>
  <h1>第4讲 | DHCP与PXE：IP是怎么来的，又是怎么没的？</h1>
  <div data-v-87ffcada="" class="article"><!----> <div data-v-87ffcada="" class="main main-app"><div data-v-87ffcada="" class="breadcrumb breadcrumb pd"><span><a href="/" class="title router-link-active">讲堂</a> <span class="split iconfont"></span></span><span><a href="/column/85" class="title">趣谈网络协议</a> <span class="split iconfont"></span></span><span><span class="title">文章详情</span> <!----></span></div> <h1 data-v-87ffcada="" class="article-title pd">
      第4讲 | DHCP与PXE：IP是怎么来的，又是怎么没的？
    </h1> <div data-v-87ffcada="" class="article-info pd"><span data-v-87ffcada="">2018-05-25</span> <span data-v-87ffcada="">刘超</span></div> <div data-v-87ffcada="" class="article-content typo common-content pd"><img data-v-87ffcada="" src="https://static001.geekbang.org/resource/image/4e/93/4e4b432837b091c064bc3ef23a4b0093.jpg"> <!----> <div data-v-87ffcada="" class="mini-audio-player"><a href="javascript:;" class="btn-play"></a> <div class="audio-info"><h3>第4讲 | DHCP与PXE：IP是怎么来的，又是怎么没的？</h3> <p><span>朗读人：刘超&nbsp;&nbsp;&nbsp;</span> <span>13′49′′ | 6.36M</span></p></div> <!----> <audio title="第4讲 | DHCP与PXE：IP是怎么来的，又是怎么没的？" src="https://res001.geekbang.org/media/audio/8f/35/8fcc98e770f39dc43af82f717ffd4f35/ld/ld.m3u8"></audio></div> <div data-v-87ffcada="" id="article-content" class=""><div class="text"><p>上一节，我们讲了 IP 的一些基本概念。如果需要和其他机器通讯，我们就需要一个通讯地址，我们需要给网卡配置这么一个地址。</p>
<h2>如何配置 IP 地址？</h2>
<p>那如何配置呢？如果有相关的知识和积累，你可以用命令行自己配置一个地址。可以使用 ifconfig，也可以使用 ip addr。设置好了以后，用这两个命令，将网卡 up 一下，就可以开始工作了。</p>
<p><strong>使用 net-tools：</strong></p>
<pre style="position: relative;"><code><table class="hljs-ln"><tbody><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">$ sudo ifconfig eth1 10.0.0.1/24</div></td></tr><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">$ sudo ifconfig eth1 up</div></td></tr></tbody></table></code><div class="richcontent-pre-copy"><span class="iconfont"></span>复制代码</div></pre>
<p><strong>使用 iproute2：</strong></p>
<pre style="position: relative;"><code><table class="hljs-ln"><tbody><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">$ sudo ip addr add 10.0.0.1/24 dev eth1</div></td></tr><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">$ sudo ip link set up eth1</div></td></tr></tbody></table></code><div class="richcontent-pre-copy"><span class="iconfont"></span>复制代码</div></pre>
<p>你可能会问了，自己配置这个自由度太大了吧，我是不是配置什么都可以？如果配置一个和谁都不搭边的地址呢？例如，旁边的机器都是 192.168.1.x，我非得配置一个 16.158.23.6，会出现什么现象呢？</p>
<p>不会出现任何现象，就是包发不出去呗。为什么发不出去呢？我来举例说明。</p>
<p>192.168.1.6 就在你这台机器的旁边，甚至是在同一个交换机上，而你把机器的地址设为了 16.158.23.6。在这台机器上，你企图去 ping192.168.1.6，你觉得只要将包发出去，同一个交换机的另一台机器马上就能收到，对不对？</p>
<p>可是 Linux 系统不是这样的，它没你想得那么智能。你用肉眼看到那台机器就在旁边，它则需要根据自己的逻辑进行处理。</p>
<p>还记得我们在第二节说过的原则吗？<strong>只要是在网络上跑的包，都是完整的，可以有下层没上层，绝对不可能有上层没下层。</strong></p>
<p>所以，你看着它有自己的源 IP 地址 16.158.23.6，也有目标 IP 地址 192.168.1.6，但是包发不出去，这是因为 MAC 层还没填。</p>
<p>自己的 MAC 地址自己知道，这个容易。但是目标 MAC 填什么呢？是不是填 192.168.1.6 这台机器的 MAC 地址呢？</p>
<p>当然不是。Linux 首先会判断，要去的这个地址和我是一个网段的吗，或者和我的一个网卡是同一网段的吗？只有是一个网段的，它才会发送 ARP 请求，获取 MAC 地址。如果发现不是呢？</p>
<!-- [[[read_end]]] -->
<p><strong>Linux 默认的逻辑是，如果这是一个跨网段的调用，它便不会直接将包发送到网络上，而是企图将包发送到网关。</strong></p>
<p>如果你配置了网关的话，Linux 会获取网关的 MAC 地址，然后将包发出去。对于 192.168.1.6 这台机器来讲，虽然路过它家门的这个包，目标 IP 是它，但是无奈 MAC 地址不是它的，所以它的网卡是不会把包收进去的。</p>
<p>如果没有配置网关呢？那包压根就发不出去。</p>
<p>如果将网关配置为 192.168.1.6 呢？不可能，Linux 不会让你配置成功的，因为网关要和当前的网络至少一个网卡是同一个网段的，怎么可能 16.158.23.6 的网关是 192.168.1.6 呢？</p>
<p>所以，当你需要手动配置一台机器的网络 IP 时，一定要好好问问你的网络管理员。如果在机房里面，要去网络管理员那里申请，让他给你分配一段正确的 IP 地址。当然，真正配置的时候，一定不是直接用命令配置的，而是放在一个配置文件里面。<strong>不同系统的配置文件格式不同，但是无非就是 CIDR、子网掩码、广播地址和网关地址</strong>。</p>
<h2>动态主机配置协议（DHCP）</h2>
<p>原来配置 IP 有这么多门道儿啊。你可能会问了，配置了 IP 之后一般不能变的，配置一个服务端的机器还可以，但是如果是客户端的机器呢？我抱着一台笔记本电脑在公司里走来走去，或者白天来晚上走，每次使用都要配置 IP 地址，那可怎么办？还有人事、行政等非技术人员，如果公司所有的电脑都需要 IT 人员配置，肯定忙不过来啊。</p>
<p>因此，我们需要有一个自动配置的协议，也就是称<strong>动态主机配置协议（Dynamic Host Configuration Protocol）</strong>，简称<strong>DHCP</strong>。</p>
<p>有了这个协议，网络管理员就轻松多了。他只需要配置一段共享的 IP 地址。每一台新接入的机器都通过 DHCP 协议，来这个共享的 IP 地址里申请，然后自动配置好就可以了。等人走了，或者用完了，还回去，这样其他的机器也能用。</p>
<p>所以说，<strong>如果是数据中心里面的服务器，IP 一旦配置好，基本不会变，这就相当于买房自己装修。DHCP 的方式就相当于租房。你不用装修，都是帮你配置好的。你暂时用一下，用完退租就可以了。</strong></p>
<h2>解析 DHCP 的工作方式</h2>
<p>当一台机器新加入一个网络的时候，肯定一脸懵，啥情况都不知道，只知道自己的 MAC 地址。怎么办？先吼一句，我来啦，有人吗？这时候的沟通基本靠“吼”。这一步，我们称为<strong>DHCP Discover。</strong></p>
<p>新来的机器使用 IP 地址 0.0.0.0 发送了一个广播包，目的 IP 地址为 255.255.255.255。广播包封装了 UDP，UDP 封装了 BOOTP。其实 DHCP 是 BOOTP 的增强版，但是如果你去抓包的话，很可能看到的名称还是 BOOTP 协议。</p>
<p>在这个广播包里面，新人大声喊：我是新来的（Boot request），我的 MAC 地址是这个，我还没有 IP，谁能给租给我个 IP 地址！</p>
<p>格式就像这样：</p>
<p><img src="https://static001.geekbang.org/resource/image/39/1f/395b304f49559034af34c882bd86f11f.jpg" alt=""></p>
<p>如果一个网络管理员在网络里面配置了<strong>DHCP Server</strong>的话，他就相当于这些 IP 的管理员。他立刻能知道来了一个“新人”。这个时候，我们可以体会 MAC 地址唯一的重要性了。当一台机器带着自己的 MAC 地址加入一个网络的时候，MAC 是它唯一的身份，如果连这个都重复了，就没办法配置了。</p>
<p>只有 MAC 唯一，IP 管理员才能知道这是一个新人，需要租给它一个 IP 地址，这个过程我们称为<strong>DHCP Offer</strong>。同时，DHCP Server 为此客户保留为它提供的 IP 地址，从而不会为其他 DHCP 客户分配此 IP 地址。</p>
<p>DHCP Offer 的格式就像这样，里面有给新人分配的地址。</p>
<p><img src="https://static001.geekbang.org/resource/image/54/86/54ffefbe4f493f0f4a39f45504bd5086.jpg" alt=""></p>
<p>DHCP Server 仍然使用广播地址作为目的地址，因为，此时请求分配 IP 的新人还没有自己的 IP。DHCP Server 回复说，我分配了一个可用的 IP 给你，你看如何？除此之外，服务器还发送了子网掩码、网关和 IP 地址租用期等信息。</p>
<p>新来的机器很开心，它的“吼”得到了回复，并且有人愿意租给它一个 IP 地址了，这意味着它可以在网络上立足了。当然更令人开心的是，如果有多个 DHCP Server，这台新机器会收到多个 IP 地址，简直受宠若惊。</p>
<p>它会选择其中一个 DHCP Offer，一般是最先到达的那个，并且会向网络发送一个 DHCP Request 广播数据包，包中包含客户端的 MAC 地址、接受的租约中的 IP 地址、提供此租约的 DHCP 服务器地址等，并告诉所有 DHCP Server 它将接受哪一台服务器提供的 IP 地址，告诉其他 DHCP 服务器，谢谢你们的接纳，并请求撤销它们提供的 IP 地址，以便提供给下一个 IP 租用请求者。</p>
<p><img src="https://static001.geekbang.org/resource/image/e1/24/e1e45ba0d86d2774ec80a1d86f87b724.jpg" alt=""></p>
<p>此时，由于还没有得到 DHCP Server 的最后确认，客户端仍然使用 0.0.0.0 为源 IP 地址、255.255.255.255 为目标地址进行广播。在 BOOTP 里面，接受某个 DHCP Server 的分配的 IP。</p>
<p>当 DHCP Server 接收到客户机的 DHCP request 之后，会广播返回给客户机一个 DHCP ACK 消息包，表明已经接受客户机的选择，并将这一 IP 地址的合法租用信息和其他的配置信息都放入该广播包，发给客户机，欢迎它加入网络大家庭。</p>
<p><img src="https://static001.geekbang.org/resource/image/7d/0e/7da571c18b974582a9cfe4718c5dea0e.jpg" alt=""></p>
<p>最终租约达成的时候，还是需要广播一下，让大家都知道。</p>
<h2>IP 地址的收回和续租</h2>
<p>既然是租房子，就是有租期的。租期到了，管理员就要将 IP 收回。</p>
<p>如果不用的话，收回就收回了。就像你租房子一样，如果还要续租的话，不能到了时间再续租，而是要提前一段时间给房东说。DHCP 也是这样。</p>
<p>客户机会在租期过去 50% 的时候，直接向为其提供 IP 地址的 DHCP Server 发送 DHCP request 消息包。客户机接收到该服务器回应的 DHCP ACK 消息包，会根据包中所提供的新的租期以及其他已经更新的 TCP/IP 参数，更新自己的配置。这样，IP 租用更新就完成了。</p>
<p>好了，一切看起来完美。DHCP 协议大部分人都知道，但是其实里面隐藏着一个细节，很多人可能不会去注意。接下来，我就讲一个有意思的事情：网络管理员不仅能自动分配 IP 地址，还能帮你自动安装操作系统！</p>
<h2>预启动执行环境（PXE）</h2>
<p>普通的笔记本电脑，一般不会有这种需求。因为你拿到电脑时，就已经有操作系统了，即便你自己重装操作系统，也不是很麻烦的事情。但是，在数据中心里就不一样了。数据中心里面的管理员可能一下子就拿到几百台空的机器，一个个安装操作系统，会累死的。</p>
<p>所以管理员希望的不仅仅是自动分配 IP 地址，还要自动安装系统。装好系统之后自动分配 IP 地址，直接启动就能用了，这样当然最好了！</p>
<p>这事儿其实仔细一想，还是挺有难度的。安装操作系统，应该有个光盘吧。数据中心里不能用光盘吧，想了一个办法就是，可以将光盘里面要安装的操作系统放在一个服务器上，让客户端去下载。但是客户端放在哪里呢？它怎么知道去哪个服务器上下载呢？客户端总得安装在一个操作系统上呀，可是这个客户端本来就是用来安装操作系统的呀？</p>
<p>其实，这个过程和操作系统启动的过程有点儿像。首先，启动 BIOS。这是一个特别小的小系统，只能干特别小的一件事情。其实就是读取硬盘的 MBR 启动扇区，将 GRUB 启动起来；然后将权力交给 GRUB，GRUB 加载内核、加载作为根文件系统的 initramfs 文件；然后将权力交给内核；最后内核启动，初始化整个操作系统。</p>
<p>那我们安装操作系统的过程，只能插在 BIOS 启动之后了。因为没安装系统之前，连启动扇区都没有。因而这个过程叫做<strong>预启动执行环境（Pre-boot Execution Environment）</strong>，简称<strong>PXE。</strong></p>
<p>PXE 协议分为客户端和服务器端，由于还没有操作系统，只能先把客户端放在 BIOS 里面。当计算机启动时，BIOS 把 PXE 客户端调入内存里面，就可以连接到服务端做一些操作了。</p>
<p>首先，PXE 客户端自己也需要有个 IP 地址。因为 PXE 的客户端启动起来，就可以发送一个 DHCP 的请求，让 DHCP Server 给它分配一个地址。PXE 客户端有了自己的地址，那它怎么知道 PXE 服务器在哪里呢？对于其他的协议，都好办，要么人告诉他。例如，告诉浏览器要访问的 IP 地址，或者在配置中告诉它；例如，微服务之间的相互调用。</p>
<p>但是 PXE 客户端启动的时候，啥都没有。好在 DHCP Server 除了分配 IP 地址以外，还可以做一些其他的事情。这里有一个 DHCP Server 的一个样例配置：</p>
<pre style="position: relative;"><code><table class="hljs-ln"><tbody><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">ddns-update-style interim;</div></td></tr><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">ignore client-updates;</div></td></tr><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">allow booting;</div></td></tr><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">allow bootp;</div></td></tr><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">subnet 192.168.1.0 netmask 255.255.255.0</div></td></tr><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">{</div></td></tr><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">option routers 192.168.1.1;</div></td></tr><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">option subnet-mask 255.255.255.0;</div></td></tr><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">option time-offset -18000;</div></td></tr><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">default-lease-time 21600;</div></td></tr><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">max-lease-time 43200;</div></td></tr><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">range dynamic-bootp 192.168.1.240 192.168.1.250;</div></td></tr><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">filename "pxelinux.0";</div></td></tr><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">next-server 192.168.1.180;</div></td></tr><tr><td class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></td><td class="hljs-ln-code"><div class="hljs-ln-line">}</div></td></tr></tbody></table></code><div class="richcontent-pre-copy"><span class="iconfont"></span>复制代码</div></pre>
<p>按照上面的原理，默认的 DHCP Server 是需要配置的，无非是我们配置 IP 的时候所需要的 IP 地址段、子网掩码、网关地址、租期等。如果想使用 PXE，则需要配置 next-server，指向 PXE 服务器的地址，另外要配置初始启动文件 filename。</p>
<p>这样 PXE 客户端启动之后，发送 DHCP 请求之后，除了能得到一个 IP 地址，还可以知道 PXE 服务器在哪里，也可以知道如何从 PXE 服务器上下载某个文件，去初始化操作系统。</p>
<h2>解析 PXE 的工作过程</h2>
<p>接下来我们来详细看一下 PXE 的工作过程。</p>
<p>首先，启动 PXE 客户端。第一步是通过 DHCP 协议告诉 DHCP Server，我刚来，一穷二白，啥都没有。DHCP Server 便租给它一个 IP 地址，同时也给它 PXE 服务器的地址、启动文件 pxelinux.0。</p>
<p>其次，PXE 客户端知道要去 PXE 服务器下载这个文件后，就可以初始化机器。于是便开始下载，下载的时候使用的是 TFTP 协议。所以 PXE 服务器上，往往还需要有一个 TFTP 服务器。PXE 客户端向 TFTP 服务器请求下载这个文件，TFTP 服务器说好啊，于是就将这个文件传给它。</p>
<p>然后，PXE 客户端收到这个文件后，就开始执行这个文件。这个文件会指示 PXE 客户端，向 TFTP 服务器请求计算机的配置信息 pxelinux.cfg。TFTP 服务器会给 PXE 客户端一个配置文件，里面会说内核在哪里、initramfs 在哪里。PXE 客户端会请求这些文件。</p>
<p>最后，启动 Linux 内核。一旦启动了操作系统，以后就啥都好办了。</p>
<p><img src="https://static001.geekbang.org/resource/image/6e/a4/6e69007db3fc68ff6da8496266abf6a4.jpg" alt=""></p>
<h2>小结</h2>
<p>好了，这一节就到这里了。我来总结一下今天的内容：</p>
<ul>
<li>
<p>DHCP 协议主要是用来给客户租用 IP 地址，和房产中介很像，要商谈、签约、续租，广播还不能“抢单”；</p>
</li>
<li>
<p>DHCP 协议能给客户推荐“装修队”PXE，能够安装操作系统，这个在云计算领域大有用处。</p>
</li>
</ul>
<p>最后，学完了这一节，给你留两个思考题吧。</p>
<ol>
<li>PXE 协议可以用来安装操作系统，但是如果每次重启都安装操作系统，就会很麻烦。你知道如何使得第一次安装操作系统，后面就正常启动吗？</li>
<li>现在上网很简单了，买个家用路由器，连上 WIFI，给 DHCP 分配一个 IP 地址，就可以上网了。那你是否用过更原始的方法自己组过简单的网呢？说来听听。</li>
</ol>
<p>欢迎你留言和我讨论。趣谈网络协议，我们下期见！</p>
<p><img src="https://static001.geekbang.org/resource/image/b5/fb/b5bc14cb81d3630919fee94a512cc3fb.jpg" alt=""></p>
</div></div> <!----> <div data-v-87ffcada="" class="copyright">
        ©版权归极客邦科技所有，未经许可不得转载
      </div></div> <div data-v-87ffcada="" class="switch-btns pd"><div data-v-87ffcada="" class="btn"><div data-v-87ffcada="" class="tag">上一篇</div> <div data-v-87ffcada="" class="txt">第3讲 | ifconfig：最熟悉又陌生的命令行</div></div> <div data-v-87ffcada="" class="btn"><div data-v-87ffcada="" class="tag">下一篇</div> <div data-v-87ffcada="" class="txt">第5讲 | 从物理层到MAC层：如何在宿舍里自己组网玩联机游戏？</div></div></div> <div data-v-87ffcada="" class="to-comment pd"><a data-v-87ffcada="" class="button-primary">写留言</a></div> <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span data-v-87ffcada="">精选留言</span></h2> <ul data-v-87ffcada=""><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/53/19/965c845c.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">袁沛</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>61</span></a></div></div> <div class="bd">20年前大学宿舍里绕了好多同轴电缆的10M以太网，上BBS用IP，玩星际争霸用IPX。那时候没有DHCP，每栋楼有个哥们负责分配IP。</div> <span class="time">2018-05-25</span> <div class="reply"><div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> <p class="reply-content">赞</p> <p class="reply-time">2018-05-25</p></div></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/static/time/img/defaultAvatar.e4ab9fe.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">xcodeproj</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>41</span></a></div></div> <div class="bd">新机器进来申请分配ip地址，老师你说在dhcp request的时候这台机器以0.0.0.0为源地址发出请求，那如果有多台机器同时申请呢？DHCP server如何分辨啊</div> <span class="time">2018-05-25</span> <!----></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/ed/4d/1d1a1a00.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">magict4</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>18</span></a></div></div> <div class="bd">请问在 Offer 和 ACK 阶段，为什么 DHCP Server 给新机器的数据包中，MAC 头里用的是广播地址（ff:ff:ff:ff:ff:ff）而不是新机器的 MAC 地址？</div> <span class="time">2018-06-16</span> <!----></div></li><li data-v-87ffcada="" class="comment-item"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/FMwyx76xm95LgNQKtepBbNVMz011ibAjM42N2PicvqU9tib9n43AURiaq6CKCqEoGo9iahsNNsTSiaqANMmfCbK0kZhQ/132" class="avatar"> <div class="info"><div class="hd"><span class="username">机器人</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>17</span></a></div></div> <div class="bd">那么跨网段调用中，是如何获取目标IP 的mac地址的？根据讲解推理应该是从源IP网关获取所在网关<br>mac,然后又替换为目标IP所在网段网关的mac,最后是目标IP的mac地址，不知对否</div> <span class="time">2018-05-25</span> <div class="reply"><div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> <p class="reply-content">是的</p> <p class="reply-time">2018-05-25</p></div></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/97/39/e7985e7a.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">天涯囧侠</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>12</span></a></div></div> <div class="bd">在一个有dhcp的网络里，如果我手动配置了一个IP，dhcp Server会知道这个信息，并不再分配这个IP吗？会的话具体是怎样交互的呢？</div> <span class="time">2018-05-25</span> <div class="reply"><div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> <p class="reply-content">有可能冲突的，所以办公网里面一般禁止配置静态ip</p> <p class="reply-time">2018-05-25</p></div></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">曹铮</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>11</span></a></div></div> <div class="bd">跨网段的通信，一般都是ip包头的目标地址是最终目标地址，但2层包头的目标地址总是下一个网关的，是么？</div> <span class="time">2018-05-25</span> <div class="reply"><div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> <p class="reply-content">是的</p> <p class="reply-time">2018-05-25</p></div></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/67/95/5bd8911f.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">kevinwang527</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>8</span></a></div></div> <div class="bd">现在一般电脑的网卡几乎都支持PXE启动， PXE client 就在网卡的 ROM 中，当计算机引导时，BIOS 把 PXE client 调入内存执行。<br>安装完成后，将提示重新引导计算机。这个时候，在重新引导的过程中将BIOS修改回从硬盘启动就可以了。</div> <span class="time">2018-06-28</span> <!----></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/54/cf/fddcf843.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">芋头</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>7</span></a></div></div> <div class="bd">要是以前大学老师能够讲得如此精彩，易懂，大学就不会白学了</div> <span class="time">2018-06-01</span> <div class="reply"><div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> <p class="reply-content">谢谢</p> <p class="reply-time">2018-06-01</p></div></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/7d/95/6b0c334b.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">刘-阿-伟</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>7</span></a></div></div> <div class="bd">看了虽然懂了，但是对于一个做软件开发的，不知道怎么去实战！</div> <span class="time">2018-05-25</span> <div class="reply"><div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> <p class="reply-content">最后会有一个实验管理的搭建，一台机器足以</p> <p class="reply-time">2018-05-25</p></div></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/14/b5/d5cb9fad.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">zhy</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>7</span></a></div></div> <div class="bd">之前一直不清楚dhcp是干嘛的→_→终于明白了</div> <span class="time">2018-05-25</span> <!----></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/6e/c6/4a7b2517.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">Will王志翔(大象)</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>6</span></a></div></div> <div class="bd">以问答写笔记：<br><br>1. 正确配置IP?<br>	<br>CIDR、子网掩码、广播地址和网关地址。<br>	<br>2. 在跨网段调用中，是如何获取目标IP的mac地址的？<br>	<br>从源IP网关获取所在网关mac,<br>然后又替换为目标IP所在网段网关的mac,<br>最后是目标IP的mac地址<br>	<br>3. 手动配置麻烦，怎么办？<br>	<br>DHCP！Dynamic Host Configuration Protocol！<br>DHCP, 让你配置IP，如同自动房产中介。<br>	<br>4. 如果新来的，房子是空的(没有操作系统)，怎么办？<br>	<br>PXE， Pre-boot Execution Environment.<br>"装修队"PXE，帮你安装操作系统。</div> <span class="time">2018-07-07</span> <div class="reply"><div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> <p class="reply-content">赞</p> <p class="reply-time">2018-07-08</p></div></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/static/time/img/defaultAvatar.e4ab9fe.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">Tristen陈涛</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>6</span></a></div></div> <div class="bd">文章开头，源 IP 地址 16.158.23.6，目标 IP 地址 192.168.1.6 发包的问题，还是不太懂<br>此种情况下的结果是： 网关收到 16.158.23.6 包后直接拒绝了还是有别的处理？</div> <span class="time">2018-05-29</span> <!----></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/d0/f1/432e0476.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">贾志猛</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>6</span></a></div></div> <div class="bd">进入BIOS设置页面，有一项PXE Boot to LAN，若设置为Enabled则表示计算机从网络启动，从PXE服务端下载配置文件和操作系统内核进行启动；若设置为Disabled则表示从本地启动，启动动BIOS后，会去寻找启动扇区，如果没有安装操作系统，就会找不到启动扇区，这个时候就启动不起来。</div> <span class="time">2018-05-27</span> <div class="reply"><div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> <p class="reply-content">是的，还有一种服务端的配置</p> <p class="reply-time">2018-05-28</p></div></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/f6/41/62ea275d.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">geduo4612</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>5</span></a></div></div> <div class="bd">PXE client 只能把整个操作系统放在内存里面里面？因为此时还木有文件系统啥的吧？DHCP，ARP，IP/TCP协议都是BIOS自带的？</div> <span class="time">2018-06-03</span> <!----></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/3f/97/27c857d9.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">卡卡</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>5</span></a></div></div> <div class="bd">pxe要去tftp下载初始文件，那么pxe自己是不是也需要一个tftp客户端？</div> <span class="time">2018-05-25</span> <div class="reply"><div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> <p class="reply-content">是的，不过tftp很轻量</p> <p class="reply-time">2018-05-26</p></div></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/static/time/img/defaultAvatar.e4ab9fe.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">呵呵</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>5</span></a></div></div> <div class="bd">pxe客户端是放在哪里的？</div> <span class="time">2018-05-25</span> <div class="reply"><div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> <p class="reply-content">bios</p> <p class="reply-time">2018-05-25</p></div></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/12/ce/a8c8b5e8.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">Jason</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>5</span></a></div></div> <div class="bd">大道至简。牛</div> <span class="time">2018-05-25</span> <div class="reply"><div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> <p class="reply-content">谢谢</p> <p class="reply-time">2018-05-25</p></div></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/0f/fe/8f/466f880d.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">没心没肺</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>4</span></a></div></div> <div class="bd">DHCP Request究竟使用广播还是单播取决于DHCP Offer包中Broadcast位的设置值。该位置1则使用广播发送，置0则使用单播发送。</div> <span class="time">2018-05-25</span> <!----></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/10/57/0f/1f229bf5.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">王贺</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>4</span></a></div></div> <div class="bd">我印象中10.0.0.1/24是路由器地址，这是把这台机器配成路由器了么？配成10.0.0.2/24也没问题吧？</div> <span class="time">2018-05-25</span> <div class="reply"><div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> <p class="reply-content">没问题，这只是个配置的例子</p> <p class="reply-time">2018-05-25</p></div></div></li><li data-v-87ffcada="" class="comment-item"><img src="https://static001.geekbang.org/account/avatar/00/11/4c/fd/8022b3a2.jpg" class="avatar"> <div class="info"><div class="hd"><span class="username">penghuster</span> <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span>3</span></a></div></div> <div class="bd">请教一下，pxe客户端请求的IP，是否最终会直接用于系统</div> <span class="time">2018-06-01</span> <div class="reply"><div class="reply-hd"><i class="iconfont"></i> <span>作者回复</span></div> <p class="reply-content">不会的，系统起来后配置ip是他自己的事情</p> <p class="reply-time">2018-06-01</p></div></div></li></ul></div></div> <!----> <!----></div>
</body>
</html>