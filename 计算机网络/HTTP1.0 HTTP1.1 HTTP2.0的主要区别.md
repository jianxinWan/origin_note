# HTTP1.0 HTTP1.1 HTTP2.0

## HTTP的基本优化

影响一个HTTP网络请求的因素主要有两个：`带宽和延迟`

### 带宽

在之前我们如果还停留在拨号上网的阶段，带宽可能会成为一个比较严重的问题，但是现在网络基础建设使我们的带宽得到了很大的提升，我们不用再担心带宽影响网速，延迟往往是我们网络请求中需要优化的地方。

### 延迟

- `浏览器阻塞`，浏览器会因为一些原因阻塞请求，浏览器对于同一个域名来说，只能有`四个连接`，超过浏览器最大的链接数限制之后，后续请求会被阻塞。
- `DNS查询`,浏览器通常需要知道目标服务器的ip才能建立连接，将域名解析为ip的这个系统就是DNS,我们通常可以利用DNS缓存来减少查询时间。
- `建立连接` 浏览器最快也要通过三次握手才能捎带上HTTP请求报文，达到真正的建立连接，但是这些连接无法复用会导致每次请求都经历三次握手和慢启动，三次握手在高延迟下影响比较明显，慢启动对文件类大请求影响比较大。

## HTTP1.0 HTTP1.1

### 长链接

- `http1.0`需要使用`keep-alive`参数来告知服务器需要建立一个长链接，而`HTTP1.0`才支持长链接。
- `http`是基于`tcp/ip`协议的，创建一个`tcp`连接通常需要经过三次握手，有一定的开销，如果每次都需要建立连接的话，对性能有一定的影响，因此需要建立一个长链接，通过长链接来发送多个请求。`这样减少了建立和关闭连接的消耗和延迟，一定程度上弥补了HTTP1.0每次请求都要建立连接的缺点`。
- `管线化技术`,管线化技术是基于持久化连接之上的，进一步对通信性能的提升，在持久化连接下，请求和响应是顺序执行的，上次请求得到响应之后，才能发送下一次请求。`管线化技术就是未收到响应时，顺序发送多个请求`

### 带宽优化及网络连接的使用

`HTTP1.1`只发送`header`信息，服务器会检测`header`信息中是否有权请求服务器，如果有权访问，则返回100,否则返回401,客户端如果接收到100,才开始把请求`body`发送到服务器。这样当服务器返回401的时候，客户端就不用发送请求`body`了，节约了带宽。另外`HTTP1.1`还支持发送内容的一部分，这样当客户端已经有一部分的资源后，只需要跟服务器请求另外部分的资源即可。支持文件断点续传的基础。

### HOST域

`HTTP1.0`是没有`host`域的，HTTP`1.1`才支持这个参数。

在HTTP1.1中认为每台服务器都绑定一个唯一的ip地址，因此，消息中URL并没有传递主机名，但是随着虚拟主机技术，每个服务器可存在多个虚拟主机，并且他们共享一个ip地址，HTTP1.1的请求消息和响应消息都应支持HOST头域，并且头域会报告一个错误（400）

## HTTP1.1和2.0的区别

### 多路复用

`HTTP2.0`使用到了多路复用的技术，做到同一个连接并发处理多个请求，而且并发处理请求量比`HTTP1.1`大了好几个数量等级。
`TCP`连接会有一个预热和保护的过程，先检查数据是否传送成功，成功之后，会一点一点加大传送速度，因此对于瞬间并发的连接，服务器的响应就会变慢，所以最好能使用一个建立好的连接，并且这个连接可以支持瞬间并发的请求。

![多路复用](https://user-gold-cdn.xitu.io/2018/10/18/16684c501ec9c769?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

### 数据压缩

`HTPP1.1`不会对`header`进行压缩，`HTTP2.0`会使用`HPACK`算法对`header`数据进行压缩，这样网络传输速度将会变快。

### 服务器推送

对支持`HTTP2.0`的`web`服务器来说，服务器会顺便把一些客户端需要的资源一起推送到客户端，免得客户端再次创建发送请求到服务器端的获取，这种方式非常适合加载静态资源。服务去器推送的资源其实存在客户端的某些地方，客户端直接从本地加载这些资源就可以了，不用走网络，速度相对比较快。
